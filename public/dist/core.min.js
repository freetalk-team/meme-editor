(()=>{"use strict";const e={append(e,t=!1){t?this.area.insertBefore(e,this.area.firstElementChild):this.area.appendChild(e)},appendTemplate(e,t,s="div",...i){const r=dom.renderTemplate(e,t,s,[...i]);return this.append(r),r},removeContent(){dom.removeChilds(this.area)},querySelector(e){return this.area.querySelector(e)},querySelectorAll(e){return this.area.querySelectorAll(e)},getLastElement(){return this.area.lastElementChild},getFirstElement(){return this.area.firstElementChild},moveTop(e,t=!1){t?dom.moveAfterTop(e):dom.moveTop(e)},insertTop(e){dom.insertTop(e,this.area)},addStyle(...e){this.area.classList.add(...e)},removeStyle(...e){this.area.classList.remove(...e)},removeSelf(){dom.removeElement(this.area)},getViewport(){return this.area.getBoundingClientRect()},showSelf(e){const t=e?this.area.parentElement:this.area;dom.showElement(t)},hideSelf(e){const t=e?this.area.parentElement:this.area;dom.hideElement(t)},childCount(){return this.area.childElementCount}};class t{#e;#t;#s;get area(){return this.#t}get viewport(){return this.#e.getBoundingClientRect()}set bottom(e){this.alignBottom=e,this.posY=1}get sliderMaxY(){return this.height-this.sliderHeight}get sliderPosY(){return this.sliderMaxY*this.posY}get containerElement(){return this.#e}get parentElement(){return this.#e.parentElement}get firstElement(){return this.#e.firstElement}get Y(){return this.posY}set Y(e){this.posY=e,this.#i(),this.#r()}get offsetY(){return Math.floor(this.posY*this.totalHeight)}set offsetY(e){if(this.totalHeight>0){const t=Math.abs(e/this.totalHeight);this.Y=t<=1?t:1}}constructor(e){this.height=e.getBoundingClientRect().height,this.scroller=e.querySelector("div.v-scroller"),this.slider=this.scroller.querySelector("div.slider"),this.#t=e.querySelector("div.content");const t=this.area.getBoundingClientRect();this.totalHeight=t.height,this.#s=t.width,this.posY=0,this.alignBottom=!1,this.scrolling=!1,this.#t.hasAttribute("bottom")&&(this.bottom=!0),this.#e=e,this.#n(),this.resizeObserver=new ResizeObserver((t=>{const s=Math.floor(e.getBoundingClientRect().height);s>0&&(this.height=s,this.#o())})),this.resizeAreaObserver=new ResizeObserver((()=>{const e=this.#t.getBoundingClientRect(),t=Math.ceil(e.height);if(Math.abs(this.#s-e.width)>20){this.#s=e.width;const t=this.area.querySelectorAll(".marquee-container > .marquee");for(const e of t){const t=e.clientWidth,s=e.parentElement.clientWidth;let i=s/100*1.2;t>s?i+=t/s:i-=s/t,i=Math.floor(i),i<4&&(i=4),e.style.animationDuration=`${i}s`}}if(t>0){const e=this.alignBottom?this.totalHeight-this.offsetY:this.offsetY,s=this.totalHeight;this.totalHeight=t,this.#n(),this.offsetY=this.alignBottom?t-e:e,this.onHeightChange(s,t,this.height)}}))}registerEvents(){this.resizeObserver.observe(this.#e),this.resizeAreaObserver.observe(this.area),this.#e.addEventListener("wheel",this,{passive:!0}),this.#e.addEventListener("keyup",this),this.registerSliderEvents()}unregisterEvents(){this.resizeObserver.unobserve(this.#e),this.resizeAreaObserver.unobserve(this.area),this.#e.removeEventListener("wheel",this),this.#e.removeEventListener("keyup",this),this.unregisterSliderEvents()}registerSliderEvents(){this.slider.addEventListener("mouseup",this),this.slider.addEventListener("mousedown",this),this.slider.addEventListener("mouseleave",this),this.slider.addEventListener("mousemove",this)}unregisterSliderEvents(){this.slider.removeEventListener("mouseup",this),this.slider.removeEventListener("mousedown",this),this.slider.removeEventListener("mouseleave",this),this.slider.removeEventListener("mousemove",this)}handleEvent(e){switch(e.type){case"wheel":if(this.totalHeight>this.height){if(this.posY<=0&&e.deltaY<0)return;if(this.posY>=1&&e.deltaY>0)return;const t=e.deltaY;let s=this.posY+t/this.totalHeight;s>1?s=1:s<0&&(s=0),this.posY=s,this.#a()}return!0;case"keyup":if(this.totalHeight>this.height){const t=this.height/this.totalHeight;33==e.keyCode?this.posY>0&&(this.posY-=t,this.posY<0&&(this.posY=0),this.#a()):34==e.keyCode&&this.posY<1&&(this.posY+=t,this.posY>1&&(this.posY=1),this.#a())}return!0;case"mousedown":e.stopPropagation(),this.scrolling=!0,this.sliderY=e.offsetY;break;case"mouseup":e.stopPropagation(),this.scrolling=!1;break;case"mousemove":if(this.scrolling){e.stopPropagation();const t=e.offsetY-this.sliderY,s=this.sliderPosY;if(s<=0){if(t<=0)return;this.posY=t/this.sliderMaxY}else this.posY*=(s+t)/s;this.posY>1?this.posY=1:this.posY<0&&(this.posY=0),this.#a()}break;case"mouseleave":this.scrolling=!1,e.stopPropagation()}return!1}setFocus(){this.#e.focus()}scrollTo(e){const t=e.getBoundingClientRect().top;if(t<=10)return void(this.Y=0);const s=this.totalHeight;s>0&&(this.Y=t/s)}scrollBottom(){this.posY=1,this.#a(),this.alignBottom&&this.totalHeight<this.height&&(this.area.style.top=this.height-this.totalHeight+"px")}onScrollY(){}onHeightChange(){}#a(){this.#i(),this.#r();const e=Math.floor(this.posY*this.totalHeight);this.onScrollY(e,this.totalHeight)}#n(){this.#o(),this.#r()}#o(){if(0!=this.totalHeight)if(this.totalHeight<=this.height)this.scroller.style.display="none";else{this.scroller.style.display="block",this.scroller.style.height=`${this.height}px`;const e=this.height/this.totalHeight;let t=this.height*e;t<20&&(t=20),this.slider.style.height=`${t}px`,this.sliderHeight=t,this.#i()}else this.scroller.style.display="none"}#i(){const e=Math.floor((this.height-this.sliderHeight)*this.posY);this.slider.style.top=`${e}px`}#r(){if(this.totalHeight<=this.height)return void(this.alignBottom?this.area.style.top=this.height-this.totalHeight+"px":this.area.style.top="0px");const e=this.totalHeight-this.height,t=Math.ceil(this.posY*e);this.area.style.top=-t+"px"}static createContent(e){const t=dom.createElement("div","slider"),s=dom.createElement("div","v-scroller");s.appendChild(t);const i=dom.createElement("div","shadow"),r=dom.createElement("div","content");r.setAttribute("tabindex","0");const n=dom.createElement("div","area");n.appendChild(i),n.appendChild(r),e.appendChild(s),e.appendChild(n),e.classList.add("scrollable")}static create(e){return t.createContent(e),new t(e)}static createElement(e){const t=dom.renderTemplate("scrollable");return e&&e.appendChild(t),t}static createMixin(t){return{area:t,...e}}}Object.assign(t.prototype,e);const s="hidden";class i{constructor(e){let t="string"==typeof e?document.getElementById(e):e;"TEMPLATE"==t.tagName&&(t=dom.renderTemplate(t.id)),this.container=t}set id(e){this.container.dataset.id=e}get id(){return this.container.dataset.id||this.container.id}get headerElement(){return this.container.querySelector(":scope > .header")}get editorElement(){return this.container.querySelector(".editor")}get active(){return!this.container.classList.contains(s)}get viewport(){return this.container.getBoundingClientRect()}set mode(e){e?this.container.setAttribute("mode",e):this.container.removeAttribute("mode")}onAction(){}onCommand(){}onEditorAction(){}onInput(){}onChange(){}onFilter(){}onKeyPress(){}onClick(){}onLinkClick(){}onElementClick(){}onResize(){}loadAutocomplete(){}static createHeader(e){const t=dom.createElement("div","header");return e.appendChild(t),t}static createEditor(e){const t=dom.createElement("div","editor");return e.appendChild(t),t}}const r={hide(){this.container.classList.add(s)},show(){this.container.classList.remove(s)},getElementByClass(e){return this.container.querySelector(`:scope > .${e}`)},getButton(e){return this.container.querySelector(`button[name="${e}"]`)},showLoading(){const e=dom.createElement("div","loader");return this.container.appendChild(e),e},query(e){return this.container.querySelector(e)},appendChild(e,t=!1){t&&this.container.firstElementChild?dom.insertBefore(e,this.container.firstElementChild):this.container.appendChild(e)},removeChilds(){dom.removeChilds(this.container)},clearContent(){this.container.innerHTML=""},removeSelf(){dom.removeElement(this.container)},updateTimes(e=Date.now()){dom.updateElapsed(this.container,e)},addStyle(...e){this.container.classList.add(...e)},toggleLoading(e="loading3"){return this.container.classList.toggle(e)},addTemplate(e,t,s="div",...i){const r=dom.renderTemplate(e,t,s,...i);return this.container.appendChild(r),r},queryElement(e){return this.container.querySelector(e)},querySelector(e){return this.container.querySelector(e)},querySelectorAll(e){return this.container.querySelectorAll(e)}};Object.assign(i.prototype,r);class n extends i{get sashElement(){return this.container.querySelector("div.v-sash")}get sidebarElement(){return this.container.querySelector("div.sidebar")}get meta(){return{}}static createMixin(e){return{container:e,...r}}}class o{constructor(){this.pages=new Map,this.current=null}get currentPage(){return this.pages.get(this.current)}}const a={addPage(e,t){let s=t;if("string"==typeof t){const i=document.getElementById(t);return s=new n(i),s.hide(),void this.pages.set(e,s)}return t.hide(),this.pages.set(e,t),s},switchTo(e){if(this.current==e)return this.pages.get(e);if(this.current){this.pages.get(this.current).hide()}const t=this.pages.get(e);return t&&(t.show(),this.current=e),t},getPage(e){return this.pages.get(e)},getCurrentPage(){return this.pages.get(this.current)},remove(e){let t;"string"==typeof e?(t=e,e=this.pages.get(t)):t=e.id;const s=e.container;dom.removeElement(s),this.pages.delete(t)}};Object.assign(o.prototype,a);const l=Object.assign({addItem(e,t=!1){const s=e.create();return e.render(s),this.append(s),t&&this.area.insertBefore(s,this.area.firstElementChild),s},addItemTemplate(e,t,s=!1,...i){const r=this.elementTag||"div";let n=[];i.length>0&&Array.isArray(i[0])&&(n=i.shift());const o=dom.renderTemplate(e,t,r,...n);if(o.classList.add("item"),!o.dataset.id&&t.id&&(o.dataset.id=t.id),i.length>0&&o.classList.add(...i),this.append(o),s){let e=this.area.firstElementChild;if("li"===r)e&&"LH"==e.tagName&&(e=e.nextElementSibling);this.area.insertBefore(o,e)}return o},addGroup(e={},t=!1){return h.createGroup(this.area,e,t)},addContent(e={}){const t=Object.assign({template:"list-group-content",item:"list-base-item",hide:!1,empty:!1,draggable:!1,visible:-1>>>0},e),s=dom.renderTemplate(t.template,t);return t.name&&s.setAttribute("name",t.name),t.id&&(s.dataset.id=t.id),top?this.area.insertBefore(s,this.area.firstElementChild):this.area.appendChild(s),c(s,t)},wrapGroup(e,t){const s="string"==typeof e?this.area.querySelector(`[group="${e}"]`):e;return h.wrapGroup(s,t)},open(e){if(!e)return;const t=this.getElement(e);t&&!t.hasAttribute("selected")&&(this.clearSelection(),t.setAttribute("selected",""))},clearSelection(e){if(e){const t=this.getElement(e);t&&t.removeAttribute("selected")}else h.clearSelection(this.area)},getSelected(){return this.querySelector(".item[selected]")},selectItem(e){const t=this.getSelected();if(t){if(t.dataset.id==e)return;t.removeAttribute("selected")}const s=this.getElement(e);return s&&s.setAttribute("selected",""),s},delete(e){const t=this.getElement(e);return t&&t.parentElement.removeChild(t),t},getElement(e){return this.area.querySelector(`.item[data-id="${e}"]`)},getElements(e){const t=e?`.item[data-id="${e}"]`:".item[data-id]";return Array.from(this.querySelectorAll(t))},getLastElement(){return this.area.lastElementChild},getElementBy(e,t){return this.area.querySelector(`.item[data-${e}="${t}"]`)},getElementsBy(e,t){return this.area.querySelectorAll(`.item[data-${e}="${t}"]`)},getElementByClass(e){return this.area.querySelector(`.item.${e}`)},getElementIds(){return this.getElements().map((e=>e.dataset.id))},getItem(e){return this.area.querySelector(`:scope > .item[data-id="${e}"]`)},getItems(e,t,s=":scope > .item"){return e&&(s+=t?`[data-${e}="${t}"]`:`[data-${e}]`),this.area.querySelectorAll(s)},swap(e,t){const s=this.area,i=s.children;if(e>=i.length||t>=i.length||e<0||t<0)return void console.error("Invalid indexes",e,t);const r=i[e],n=i[t],o=document.createElement("div");s.insertBefore(o,r),s.insertBefore(r,n),s.insertBefore(n,o),s.removeChild(o)},queryItems(e){const t=`:scope > .item ${e}`;return this.area.querySelectorAll(t)},registerClickHandlers(){this.area.onclick=e=>{const t=e.target;if(!h.handleClick(t,this)&&"BUTTON"===t.tagName){let e,s=t.closest(".item[data-id]");if(s)e=s.dataset.id;else{let s,i=t.closest(".group");s=i?i.querySelector("[group]"):t.closest("[group]"),s&&(e=s.getAttribute("group"))}this.onAction(t.name,e,t)}}},filter(e,t=".item"){if(!e||""==e)return void this.clearFilter();const s=new RegExp(e,"i"),i=this.getItems("name",null,t);for(const e of i){const t=e.dataset.name;s.test(t)?e.classList.remove("filter"):e.classList.add("filter")}},filterFields(e,...t){if(!e||""==e)return void this.clearFilter();const s=new RegExp(e,"i"),i=this.getItems();let r,n;for(const e of i){r=!1;for(const i of t)if(n=e.querySelector(`[role="${i}"]`),n&&s.test(n.innerText)){r=!0;break}r?e.classList.remove("filter"):e.classList.add("filter")}},clearFilter(){const e=this.querySelectorAll(".item.filter");for(const t of e)t.classList.remove("filter")},filterDelay(e,t,s=[".name"]){const i=()=>{const e=this.getItems();for(const t of e)dom.showElement(t)};console.debug("Filter:",e),this._filter=e.toLowerCase(),e.length<3?i():(this._filterTimeout&&clearTimeout(this._filterTimeout),this._filterTimeout=setTimeout((async()=>{if(this._filter.length<3)i();else{this.toggleLoading(),t.disabled=!0,await sleep(800),t.disabled=!1,t.focus(),this.toggleLoading();const e=this.getItems();for(const t of e){let e=!1;for(const i of s){if(-1!=t.querySelector(i).innerText.toLowerCase().search(this._filter)){e=!0;break}}e?dom.showElement(t):dom.hideElement(t)}}delete this._filter,delete this._filterTimeout}),1e3))},sort(e){const t=this.getItems(),s=[].slice.call(t).sort(e);for(const e of s)this.area.appendChild(e)},clear(){const e=this.getElements();for(const t of e)dom.removeElement(t)},toggleLoading(){return dom.toggleLoading(this.area)},async loadGroups(){const e=this.area.querySelectorAll("[group][ds]");for(const t of e)await h.loadGroup(t)}},e);class h extends t{set hover(e){e?this.containerElement.removeAttribute("nohover"):this.containerElement.setAttribute("nohover","")}scrollToItem(e){const t=this.getElement(e);t&&(this.scrollTo(t),dom.highlightElement(t))}static create(e){const t=h.createElement(e);return new h(t)}static createElement(e){const s=t.createElement(e);return s.classList.add("list2"),s.tabIndex=0,s}static createItemElement(e){const t=document.createElement("div");return t.classList.add("item",...e.template.split(" ")),e.id&&(t.dataset.id=e.id),e.draggable&&(t.draggable=!0,t.addEventListener("dragstart",(t=>e.setDraggableData(t.dataTransfer)))),t}static clearSelection(e){const t=e.querySelectorAll(".item[selected]");for(const e of t)e.removeAttribute("selected")}static createMixin(e,t="div"){return{area:e,elementTag:t,...l}}static createPageMixin(e,t="div"){return{container:e,area:e,elementTag:t,...r,...l}}static createGroup(e,t,s=!1){const i=Object.assign({template:"list-group",item:"list-base-item",badge:!1,collapse:!0,hide:!1,empty:!1,draggable:!1,visible:-1>>>0},t);let r,n;if(i.template?(r=dom.renderTemplate(i.template,i),n=r.querySelector(".content")):(r=dom.createElement("div","list"),n=r),i.classes&&r.classList.add(...Array.isArray(i.classes)?i.classes:i.classes.split(" ")),i.badge&&r.classList.add("badge"),i.name&&r.setAttribute("name",i.name),i.id&&(r.dataset.id=i.id),s?e.insertBefore(r,e.firstElementChild):e.appendChild(r),i.help){const e=dom.renderTemplate(i.help);n.classList.add("help"),n.appendChild(e)}return c(n,i)}static wrapGroup(e,t){const s=h.createMixin(e),i=t||e.getAttribute("template")||"list-base-item",r=parseInt(e.getAttribute("visible")||5);return e.dataset.count||(e.dataset.count=r),s.add=function(t,s=!1,...r){const n=this.addItemTemplate(i,t,s,...r);if(this.childCount()>parseInt(e.dataset.count))if(s);else{dom.hideElement(n);const t=e.closest(".group");if(t){const e=t.querySelector('[name="_more"]');e&&dom.showElement(e)}}return n},s.get=function(e){return this.getItem(e)},s.load=async function(e){const t=await e.ls();for(const e of t)this.add(e)},s.push=function(...e){for(const t of e)this.add(t)},s}static async loadGroup(e){const t=h.wrapGroup(e),s=app.ds(e.getAttribute("ds"));let i,r,n;t.toggleLoading(),i=await delayResolve(s.load(t),1200),t.toggleLoading(),n=e.closest(".group"),n&&(r=n.querySelector('[name="_more"]'),r&&(i?dom.showElement(r):dom.hideElement(r)))}static handleClick(e,t){if("BUTTON"==e.tagName)switch(e.name){case"_less":{const t=e.parentElement.nextElementSibling,s=parseInt(t.getAttribute("visible")),i=d(t).reverse(),r=i.length-s>=s?s:i.length-s;for(let e=0;e<r;++e)dom.hideElement(i[e]);t.classList.add("more"),i.length-r<=s&&t.parentElement.classList.remove("less")}return!0;case"_up":return m(e,"group"),!0;case"up":m(e,"item");break;case"rm":{const t=e.closest(".item");if(t){const e=t.closest("[group]");if(e){const t=e.querySelector(":scope > .item.hidden");t&&dom.showElement(t);e.closest(".group")}dom.removeElement(t)}}}else if("A"==e.tagName)switch(e.name){case"_more":{const t=e.closest(".group");if(t){const s=t.querySelector("[group]");if(s){const t=parseInt(s.getAttribute("visible")||5),i=parseInt(s.dataset.count||t);s.dataset.count=i+t;const r=d(s,!1).slice(0,t);for(const e of r)dom.showElement(e);r.length<t&&(dom.hideElement(e),s.hasAttribute("ds")&&h.loadGroup(s))}const i=t.querySelector('[name="_less"]');i&&dom.showElement(i)}}return!0;case"_less":{const t=e.closest(".group");if(t){const s=t.querySelector("[group]");if(s){const t=parseInt(s.getAttribute("visible")||5),i=parseInt(s.dataset.count||t),r=i-t;s.dataset.count=r;const n=d(s),o=t-(i-n.length);for(const e of n.reverse().slice(0,o))dom.hideElement(e);r==t&&dom.hideElement(e)}const i=t.querySelector('[name="_more"]');i&&dom.showElement(i)}}return!0}else{if(e.hasAttribute("grouphdr"))return e.parentElement.classList.toggle("collapsed"),!0;if(e.hasAttribute("group")&&e.classList.contains("more")){const t=parseInt(e.getAttribute("visible")),s=e.querySelectorAll(":scope > .item.hidden"),i=Math.min(s.length,t);for(let e=0;e<i;++e)dom.showElement(s[e]);s.length<=t&&e.classList.remove("more");return e.parentElement.classList.add("less"),!0}}if(t){if(h.isItem(e)){const s=e.dataset.id;t.onClick(s,e)}}}static isItem(e){return e.classList.contains("item")}}Object.assign(h.prototype,l);function c(e,t){return t.hide&&e.classList.add("hidable"),t.empty&&e.classList.add("show-empty"),t.count&&e.classList.add("count"),t.hideFirst&&e.classList.add("hide-first"),t.cmd&&e.setAttribute("cmd",t.cmd),t.ds&&e.setAttribute("ds",t.ds),t.item&&e.setAttribute("template",t.item),{count:0,...h.createMixin(e),addTemplate(s,i,r=!1,n=[],...o){let a=!1;if(t.visible){const s=t.visible;a=!r,this.count>s?e.classList.add("more"):this.count<s&&(a=!1)}++this.count;const l=this.addItemTemplate(s,i,r,n,...o);return t.draggable&&(l.draggable=!0),a&&dom.hideElement(l),l},add(...e){return this.addTemplate(t.item,...e)},get(e){return this.getItem(e)},async load(e,t){const s=await e.ls();t&&s.sort(t);for(const e of s)this.add(e)},push(...e){for(const t of e)this.add(t)}}}function d(e,t=!0){const s=t?":not(.hidden)":".hidden";return Array.from(e.querySelectorAll(":scope > .item"+s))}function m(e,t="group"){const s=e.closest("."+t);if(s){let e;for(;;){if(e=s.previousElementSibling,e&&e.classList.contains(t)){if(dom.moveUp(s),!dom.isElementVisible(e))continue;dom.highlightElement(s)}break}}}class u extends n{get scrollableElement(){return this.query(".editor .scrollable")}get scrollableContent(){return this.query(".editor .scrollable > .area > .content")}set bottom(e){this.area.setAttribute("bottom","")}get height(){return this.scrollableElement.getBoundingClientRect().height}constructor(e,s={}){let i;i=e?"string"==typeof e?document.getElementById(e):e:dom.renderTemplate("editor-base",s,"div","editor-header-grid","editor-scrollable"),i.querySelector("div.header")||u.createHeader(i);let r=i.querySelector("div.editor");r||(r=u.createEditor(i));let n=r.querySelector(".scrollable");n||(n=t.createElement(r)),super(i),this.area=n.querySelector(".content")}onScrollY(){}onResize(){}registerEvents(){}}Object.assign(u.prototype,e);class g extends u{constructor(e){super(e);this.scrollableElement.classList.add("list2")}}Object.assign(g.prototype,l);class p extends g{onFilter(e){1!=e.length&&this.filter(e)}}class f extends p{pages=new Map;get currentPage(){return this.pages.get(this.current)}}Object.assign(f.prototype,a),window.UX={Scrollable:t,ScrollableMixin:e,List:h,ListMixin:l,ListItem:class{constructor(e){this.info=e}get template(){return"column"}get id(){return this.info.id}get draggable(){return!1}create(){return h.createItemElement(this)}render(){}},Page:n,PageController:o,PageControllerMixin:a,ScrollablePage:u,ListPage:p,ListPageController:f}})();